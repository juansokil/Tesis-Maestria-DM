---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Especialización en Estudios de Género








```{r, warning=FALSE, include=FALSE}
library(readr)
library(ggplot2)
library(scales)
library(maps)
library(countrycode)
library(rworldmap)
library(dplyr)
library(tidyr)
library(tidyverse)
library(dunn.test)
library(ggrepel)

```

En este codigo se definen los colores a utilizar en los distintos graficos

```{r, warning=FALSE, include=FALSE}

manualcolors<-c('Africa Austral'='forestgreen', 
                'Africa Central'= 'red2', 
                'Africa del Norte' ='orange',
                'Africa Occidental'= 'cornflowerblue', 
                'Africa Oriental' = 'gainsboro',
                'America Central' = 'darkolivegreen4',
                'America del Norte' = 'indianred1',
                'America del Sur' = 'tan4', 
                'Asia Central' = 'darkblue',
                'Asia del Sur' = 'mediumorchid1',
                'Asia Occidental' = 'seagreen',
                'Asia Oriental' = 'yellowgreen', 
                'Australia y Nueva Zelanda' = 'lightsalmon',
                'Caribe' = 'tan3',
                'Europa del Norte' = "tan1",
                'Europa del Sur' = 'darkgray', 
                'Europa Occidental' = 'wheat4',
                'Europa Oriental' = 'chartreuse',  
                'Sudeste Asiatico' = 'moccasin')

continentcolors<-c('Africa'='gray11', 
                   'America' = 'red2',
                   'Asia' = 'yellow3',
                   'Oceania' ='forestgreen',
                   'Europa' = "cornflowerblue")



variable_order <- c('T96',  'T21',  'T43',  'T52',  'T03',  
                    'T08',  'T12',  'T84',  'T06',  'T41',  
                    'T73',  'T92',  'T32',  'T62',  'T17',
                    'T55',  'T72',  'T90',  'T09',  'T11',  
                    'T30',  'T33',  'T16',  'T48',  'T59',  
                    'T94',  'T97',  'T99',  'T36',  'T38')



```



```{r, warning=FALSE}


totales2 <- read_delim("C:/Users/Juan/Dropbox/POSGRADOS/Uba/99-Tesis/scripts/scripts/graficos/totales2.csv", ";", escape_double = FALSE, trim_ws = TRUE)

ggplot(totales2, aes(Ano, Especializacion)) +  geom_point() + geom_line() +
  coord_cartesian(ylim = c(0.01, 0.018))  +
  geom_smooth(method='loess', se = FALSE) +
  scale_y_continuous(labels = percent)  +
  scale_x_continuous(breaks = seq(2004, 2018, by = 1)) 
  

```

Especialización por pais

```{r, warning=FALSE}
setwd("C:/Users/Juan/Dropbox/POSGRADOS/Uba/99-Tesis/scripts/scripts/Indices")

library(readr)
indices2 <- read_delim("indices2.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
indices2$especializacion_pct = indices2$especializacion*100



```
Especialización a nivel pais

```{r}
##OPCION##
mapped_data <- joinCountryData2Map(indices2, joinCode = "ISO2", nameJoinColumn = "ISO2")
par(mai=c(0,0,0.2,0),xaxs="i",yaxs="i")
mapParams <-mapCountryData(mapped_data, nameColumnToPlot="especializacion_pct", colourPalette="topo", 
                           mapTitle = "", 
                           missingCountryCol="white", oceanCol="lightblue", addLegend=FALSE
)

```




```{r}

indice_gdi <- indices2 %>% select (country, ISO2, ISO3, continente, subcontinente, especializacion, Global_Index)


indice_gathered_1 <- indice_gdi %>%
  gather(key = Global_index, value = measurement, -c(country, ISO2, ISO3, continente, subcontinente, especializacion) )

indice_gathered_1_head <- indice_gathered_1 %>% arrange(desc(especializacion))
indice_gathered_1_head <- head(indice_gathered_1_head,92)

```
indice_gathered_1 %>% filter (!is.na(especializacion)) 



```{r}

###BOXPLOT ESPECIALIZACION###
indice_gathered_1_head %>%
  filter(continente %in%  c('Africa', 'Americas', 'Asia', 'Europe','Oceania')) %>%
  ggplot(aes(x=continente, y=especializacion,  label=ISO2, fill=subcontinente)) +
  geom_point(size=3) +
  geom_boxplot(fill = "#4271AE", colour = "#1F3552", alpha = 0.7, outlier.colour = "red", outlier.shape = 20) +
  coord_cartesian(ylim = c(0.00, 0.04))  +
  geom_label_repel(size=2) +
  # geom_jitter() +
  #geom_point() +
  #geom_jitter() +
  # facet_wrap(~continente, scales = "free", ncol=3) +
  theme(legend.title=element_blank(), axis.title.y = element_blank(), legend.position="bottom") 


```



Aplicacion de Test Estadisticos NO Parametricos *Ctrl+Alt+I*.




```{r, warning=FALSE}
setwd("C:/Users/Juan/Dropbox/POSGRADOS/Uba/99-Tesis/scripts/scripts/Indices")

library(readr)
indices2 <- read_delim("indices2.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
indices2$especializacion_pct = indices2$especializacion*100



indice_gdi <- indices2 %>% select (country, ISO2, ISO3, continente, subcontinente, especializacion, Global_Index)

indice_gathered_1 <- indice_gdi %>%
  gather(key = Global_index, value = measurement, -c(country, ISO2, ISO3, continente, subcontinente, especializacion) )

indice_gathered_1_head <- indice_gathered_1 %>% arrange(desc(especializacion))
indice_gathered_1_head <- head(indice_gathered_1_head,92)
tabla <- indice_gathered_1_head %>% group_by(subcontinente) %>% summarise(count=n(), median=median(especializacion, na.rm=TRUE), IQR=IQR(especializacion, na.rm=TRUE))


sudeste_asiatico <- indice_gathered_1_head %>% filter(subcontinente =='Sudeste Asiatico') %>% select(country, subcontinente, especializacion)
africa_oriental <- indice_gathered_1_head %>% filter(subcontinente =='Africa Oriental') %>% select(country, subcontinente, especializacion)
europa_oriental <- indice_gathered_1_head %>% filter(subcontinente =='Europa Oriental') %>% select(country, subcontinente, especializacion)


```


```{r, warning=FALSE}
indice_gathered_1_head_gathered <- 
  indice_gathered_1_head %>%
  filter(continente %in%  c('Africa', 'America', 'Asia', 'Europa')) %>%
  filter(subcontinente %in%  c('Asia Occidental','Europa del Norte','Europa del Sur', 'America del Sur', 'Europa Oriental', 'Europa Occidental', 'Asia del Sur', 'Sudeste Asiatico', 'Africa Oriental')) %>%
  select(subcontinente, especializacion)


cantidades <- indice_gathered_1_head_gathered %>%
  group_by(subcontinente) %>%
  filter(subcontinente %in%  c('Asia Occidental','Europa del Norte','Europa del Sur', 'America del Sur', 'Europa Oriental', 'Europa Occidental', 'Asia del Sur', 'Sudeste Asiatico', 'Africa Oriental')) %>%
  summarize(mean(especializacion), n())


kruskal.test(indice_gathered_1_head_gathered$especializacion~indice_gathered_1_head_gathered$subcontinente)
```
Kruskal Wallis

```{r, warning=FALSE}


kruskal.test(indice_gathered_1_head_gathered$especializacion~indice_gathered_1_head_gathered$subcontinente)
```

Test de Dunn



```{r, warning=FALSE}


dunn.test(indice_gathered_1_head_gathered$especializacion, indice_gathered_1_head_gathered$subcontinente)

```

Con los ajustes de Bonferroni y FDR

```{r, warning=FALSE}

dt <- dunn.test(indice_gathered_1_head_gathered$especializacion, indice_gathered_1_head_gathered$subcontinente)
options(scipen = 999)
dunnTest2 <- as.data.frame(dt)
p_valores <- dunnTest2$P




bonferroni <- p.adjust(p_valores, method = "bonferroni", n = length(p_valores))
fdr <- p.adjust(p_valores, method = "fdr", n = length(p_valores))




completos <- cbind(dunnTest2$comparisons, dunnTest2$P, fdr, bonferroni)
View(completos)


```


